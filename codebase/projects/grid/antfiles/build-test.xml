<?xml version="1.0"?>

<project name="grid-test" default="test" basedir=".">

    <!--call the test target for individual projects-->
    <target name="test" depends="prepare">
        <for list="${testable.projects.list}" parallel="true" param="project.name" trim="true">
            <sequential>
                <echo message="Testing project @{project.name}." />
                <trycatch property="@{project.name}.test.failed.message">
                    <try>
                        <ant inheritall="false" dir="${projects.dir}/@{project.name}"
                             antfile="build.xml" target="test">
                            <property name="test.logs.dir" value="${test.logs.dir}"/>
                        </ant>
                    </try>
                    <catch>
                        <fail message="@{project.name} Tests failed (${@{project.name}.test.failed.message})" if="test.failfast" />
                        <echo message="@{project.name} Tests failed (${@{project.name}.test.failed.message}), proceeding with other tests, but build will fail at completion." />
                        <property name="test.failed" value="true" />
                    </catch>
                </trycatch>
            </sequential>
        </for>
        <fail message="Tests failed! Consult the logs for details." if="test.failed" />
    </target>

</project>