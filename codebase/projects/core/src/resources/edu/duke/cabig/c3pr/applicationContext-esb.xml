<beans
        xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:util="http://www.springframework.org/schema/util"
        xsi:schemaLocation="
    http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
    http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.0.xsd
    ">


    <util:map id="messageTypesMapping"
              map-class="java.util.LinkedHashMap">
        <entry key="registration"
               value="REGISTER_SUBJECT"/>
        <entry key="study"
               value="STUDY_CREATION"/>
    </util:map>


    <bean id="delegatedCredentialProvider"
          class="edu.duke.cabig.c3pr.accesscontrol.SecurityContextCredentialProvider"/>

    <bean id="c3dPatientPositionResponseHandler"
          class="edu.duke.cabig.c3pr.utils.C3DPatientPositionResponseHandler"
          autowire="byType">
        <property name="marshaller">
            <bean class="edu.duke.cabig.c3pr.xml.XmlMarshaller">
                <property name="mappingFile" ref="ccts-registration-castorMapping"/>
            </bean>
        </property>
    </bean>
    
    <util:set id="caXchangeMessageResponseHandlerSet"
              set-class="edu.duke.cabig.c3pr.esb.CaXchangeMessageResponseHandlerSet">
        <ref local="c3dPatientPositionResponseHandler"/>
    </util:set>

    <!--default implementation will just track status and
set it appropriately for the domain object sent as ccts message-->
    <bean id="cctsMessageWorkflowCallbackFactory"
          class="edu.duke.cabig.c3pr.utils.DefaultCCTSMessageWorkflowCallbackFactory">
        <property name="dao" ref="studySubjectDao"/>
    </bean>

    <bean id="messageBroadcaster"
          class="edu.duke.cabig.c3pr.esb.impl.CaXchangeMessageBroadcasterImpl" lazy-init="true">
        <property name="caXchangeURL" value="${esbUrl}"/>
        <property name="messageTypesMapping" ref="messageTypesMapping"/>
        <property name="messageResponseHandlers" ref="caXchangeMessageResponseHandlerSet"/>
        <property name="delegatedCredentialProvider" ref="delegatedCredentialProvider"/>
    </bean>
    
	<bean id="connectionFactory"
		class="org.apache.activemq.ActiveMQConnectionFactory">
		<property name="brokerURL" value="${jms.brokerUrl}" />
	</bean>

	<bean id="sendRegistrationRequestAffQueueDestination"
		class="org.apache.activemq.command.ActiveMQQueue">
		<constructor-arg>
			<value>co-registration-message.inputQueue</value>
		</constructor-arg>
	</bean>

	<bean id="recvRegistrationRequestCoQueueDestination"
		class="org.apache.activemq.command.ActiveMQQueue">
		<constructor-arg>
			<value>co-registration-message.outputQueue</value>
		</constructor-arg>
	</bean>
	
	<bean id="sendRegistrationResponseCoQueueDestination"
		class="org.apache.activemq.command.ActiveMQQueue">
		<constructor-arg>
			<value>affiliate-registration-message.inputQueue</value>
		</constructor-arg>
	</bean>

	<bean id="recvRegistrationResponseAffQueueDestination"
		class="org.apache.activemq.command.ActiveMQQueue">
		<constructor-arg>
			<value>affiliate-registration-message.outputQueue</value>
		</constructor-arg>
	</bean>

	<bean id="jmsCoOrdinatingCenterBroadcaster"
		class="edu.duke.cabig.c3pr.esb.impl.MessageBroadcastServiceImpl" init-method = "initialize">
		<property name="connectionFactory">
			<ref bean="connectionFactory" />
		</property>
		<property name="sendQueue">
			<ref bean="sendRegistrationRequestAffQueueDestination" />
		</property>
		<property name="recvQueue">
			<ref bean="recvRegistrationResponseAffQueueDestination" />
		</property>
		<property name="messageResponseHandler">
			<ref bean="coOrdinatingCenterResponseHandler" />
		</property>
		<property name="enableJMS" value="${multisiteEnable}"/>
	</bean>
	
	<!--<bean id="jmsAffiliateSiteBroadcaster"
		class="edu.duke.cabig.c3pr.esb.impl.MessageBroadcastServiceImpl" init-method = "initialize">
		<property name="connectionFactory">
			<ref bean="connectionFactory" />
		</property>
		<property name="sendQueue">
			<ref bean="sendRegistrationResponseCoQueueDestination" />
		</property>
		<property name="recvQueue">
			<ref bean="recvRegistrationRequestCoQueueDestination" />
		</property>
		<property name="messageResponseHandler">
			<ref bean="affiliateSiteRequestHandler" />
		</property>
		<property name="enableJMS" value="${multisiteEnable}"/>
	</bean>-->
</beans>
