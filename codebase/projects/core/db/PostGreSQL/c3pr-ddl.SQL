drop table scheduled_arms;
drop table epochs cascade;
drop table study_participant_assignments cascade;
drop table healthcare_sites cascade;
drop table study_investigators cascade;
drop table study_sites cascade;
drop table studies cascade;
drop table investigators cascade;
drop table addresses cascade;
drop table participants cascade;
drop table hc_site_investigators cascade;
drop table arms cascade;
drop table identifiers cascade;

drop SEQUENCE IDENTIFIERS_ID_seq ;
drop SEQUENCE ARMS_ID_seq ;
drop SEQUENCE STUDY_PARTICIPANT_ASSIG_ID_seq ;
drop SEQUENCE ADDRESSES_ID_seq ;
drop SEQUENCE EPOCHS_ID_seq ;
drop SEQUENCE HC_SITE_INVESTIGATORS_ID_seq ;
drop SEQUENCE HEALTHCARE_SITES_ID_seq ;
drop SEQUENCE INVESTIGATORS_ID_seq ;
drop SEQUENCE PARTICIPANTS_ID_seq ;
drop SEQUENCE SCHEDULED_ARMS_ID_seq ;
drop SEQUENCE STUDIES_ID_seq ;
drop SEQUENCE STUDY_INVESTIGATORS_ID_seq ;
drop SEQUENCE STUDY_SITES_ID_seq;


CREATE SEQUENCE IDENTIFIERS_ID_seq INCREMENT 1 START 1 ;

CREATE TABLE IDENTIFIERS ( 
	PRIMARY_INDICATOR boolean,
	GRID_ID varchar(500),
	VERSION decimal(4,2) NOT NULL,
	VALUE varchar(50) NOT NULL,
	TYPE varchar(50),
	SOURCE varchar(50) NOT NULL,
	STU_ID decimal(10,2),
	PRT_ID decimal(10,2),
	SPA_ID decimal(10,2),
	ID decimal(10,2) DEFAULT NEXTVAL('"IDENTIFIERS_ID_seq"'::TEXT) NOT NULL
) ;
CREATE SEQUENCE ADDRESSES_ID_seq INCREMENT 1 START 1 ;

CREATE TABLE ADDRESSES ( 
	GRID_ID varchar(500),
	VERSION decimal(4,2) NOT NULL,
	STREET_ADDRESS varchar(200) NOT NULL,
	CITY varchar(200) NOT NULL,
	STATE_CODE varchar(200) NOT NULL,
	COUNTRY_CODE varchar(200) NOT NULL,
	POSTAL_CODE varchar(10), 
	ID decimal(10,2) DEFAULT NEXTVAL('"ADDRESSES_ID_seq"'::TEXT) NOT NULL
) ;

CREATE SEQUENCE ARMS_ID_seq INCREMENT 1 START 1 ;

CREATE TABLE ARMS ( 
	GRID_ID varchar(500),
	VERSION decimal(4,2) NOT NULL,
	ID decimal(10,2) DEFAULT NEXTVAL('"ARMS_ID_seq"'::TEXT) NOT NULL,
	NAME varchar(50) NOT NULL,
	DESCRIPTION_TEXT varchar(50),
	TARGET_ACCRUAL_NUMBER decimal(8,2),
	EPH_ID decimal(10,2) NOT NULL
) ;

CREATE SEQUENCE EPOCHS_ID_seq INCREMENT 1 START 1 ;

CREATE TABLE EPOCHS ( 
	GRID_ID varchar(500),
	VERSION decimal(4,2) NOT NULL,
	ID decimal(10,2) DEFAULT NEXTVAL('"EPOCHS_ID_seq"'::TEXT) NOT NULL,
	NAME varchar(50) NOT NULL,
	DESCRIPTION_TEXT varchar(200),
	STU_ID decimal(10,2) NOT NULL
) ;

CREATE SEQUENCE HC_SITE_INVESTIGATORS_ID_seq INCREMENT 1 START 1 ;

CREATE TABLE HC_SITE_INVESTIGATORS ( 
	GRID_ID varchar(500),
	VERSION decimal(4,2) NOT NULL,
	ID decimal(10,2) DEFAULT NEXTVAL('"HC_SITE_INVESTIGATORS_ID_seq"'::TEXT) NOT NULL,
	INV_ID decimal(10,2) NOT NULL,
	HCS_ID decimal(10,2) NOT NULL
) ;

CREATE SEQUENCE HEALTHCARE_SITES_ID_seq INCREMENT 1 START 1 ;

CREATE TABLE HEALTHCARE_SITES ( 
	GRID_ID varchar(500),
	VERSION decimal(4,2) NOT NULL,
	ID decimal(10,2) DEFAULT NEXTVAL('"HEALTHCARE_SITES_ID_seq"'::TEXT) NOT NULL,
	NAME varchar(200) NOT NULL,
	DESCRIPTION_TEXT varchar(200),
	ADDRESS_ID decimal(10,2) NOT NULL,
	NCI_INSTITUTE_CODE varchar(50)
) ;

CREATE SEQUENCE INVESTIGATORS_ID_seq INCREMENT 1 START 1 ;

CREATE TABLE INVESTIGATORS ( 
	GRID_ID varchar(500),
	VERSION decimal(4,2) NOT NULL,
	ID decimal(10,2) DEFAULT NEXTVAL('"INVESTIGATORS_ID_seq"'::TEXT) NOT NULL,
	FIRST_NAME varchar(200),
	LAST_NAME varchar(200),
	NC_IDENTIFIER varchar(50)
) ;

CREATE SEQUENCE PARTICIPANTS_ID_seq INCREMENT 1 START 1 ;

CREATE TABLE PARTICIPANTS ( 
	GRID_ID varchar(500),
	VERSION decimal(4,2) NOT NULL,
	ID decimal(10,2) DEFAULT NEXTVAL('"PARTICIPANTS_ID_seq"'::TEXT) NOT NULL,
	FIRST_NAME varchar(200),
	LAST_NAME varchar(200),
	BIRTH_DATE timestamp,
	ADMINISTRATIVE_GENDER_CODE varchar(50) NOT NULL,
	RACE_CODE varchar(50),
	ETHNIC_GROUP_CODE varchar(50),
	ADD_ID decimal(10,2)
) ;

CREATE SEQUENCE SCHEDULED_ARMS_ID_seq INCREMENT 1 START 1 ;

CREATE TABLE SCHEDULED_ARMS ( 
	GRID_ID varchar(500),
	VERSION decimal(4,2) NOT NULL,
	ID decimal(10,2) DEFAULT NEXTVAL('"SCHEDULED_ARMS_ID_seq"'::TEXT) NOT NULL,
	START_DATE timestamp NOT NULL,
	ELIGIBILITY_INDICATOR varchar(10) NOT NULL,
	ELIGIBILITY_WAIVER_REASON_TEXT varchar(200),
	ARM_ID decimal(10,2) NOT NULL,
	SPA_ID decimal(10,2) NOT NULL
) ;

CREATE SEQUENCE STUDIES_ID_seq INCREMENT 1 START 1 ;

CREATE TABLE STUDIES ( 
	GRID_ID varchar(500),
	VERSION decimal(4,2) NOT NULL,
	ID decimal(10,2) DEFAULT NEXTVAL('"STUDIES_ID_seq"'::TEXT) NOT NULL,
	BLINDED_INDICATOR boolean,
	DISEASE_CODE varchar(50),
	LONG_TITLE_TEXT varchar(200) NOT NULL,
	MONITOR_CODE varchar(200),
	MULTI_INSTITUTION_INDICATOR boolean NOT NULL,
	PHASE_CODE varchar(50) NOT NULL,
	RANDOMIZED_INDICATOR boolean,
	SHORT_TITLE_TEXT varchar(200),
	SPONSOR_CODE varchar(200) NOT NULL,
	TARGET_ACCRUAL_NUMBER decimal(8,2),
	TYPE varchar(50) NOT NULL,
	DESCRIPTION_TEXT varchar(2000),
	PRECIS_TEXT varchar(200),
	STATUS varchar(50) NOT NULL
) ;

CREATE SEQUENCE STUDY_INVESTIGATORS_ID_seq INCREMENT 1 START 1 ;

CREATE TABLE STUDY_INVESTIGATORS ( 
	GRID_ID varchar(500),
	VERSION decimal(4,2) NOT NULL,
	ID decimal(10,2) DEFAULT NEXTVAL('"STUDY_INVESTIGATORS_ID_seq"'::TEXT) NOT NULL,
	STS_ID decimal(10,2) NOT NULL,
	HSI_ID decimal(10,2) NOT NULL,
	ROLE_CODE varchar(50) NOT NULL,
	START_DATE timestamp NOT NULL,
	END_DATE timestamp,
	STATUS_CODE varchar(50)
) ;

CREATE SEQUENCE STUDY_PARTICIPANT_ASSIG_ID_seq INCREMENT 1 START 1 ;

CREATE TABLE STUDY_PARTICIPANT_ASSIGNMENTS ( 
	GRID_ID varchar(500),
	VERSION decimal(4,2) NOT NULL,
	ID decimal(10,2) DEFAULT NEXTVAL('"STUDY_PARTICIPANT_ASSIG_ID_seq"'::TEXT) NOT NULL,
	STUDY_PARTICIPANT_IDENTIFIER varchar(50) NOT NULL,
	START_DATE timestamp NOT NULL,
	ELIGIBILITY_INDICATOR boolean,
	ELIGIBILITY_WAIVER_REASON_TEXT varchar(200),
	INFORMED_CONSENT_SIGNED_DATE timestamp,
	PRT_ID decimal(10,2) NOT NULL,
	STS_ID decimal(10,2) NOT NULL
) ;

CREATE SEQUENCE STUDY_SITES_ID_seq INCREMENT 1 START 1 ;

CREATE TABLE STUDY_SITES ( 
	GRID_ID varchar(500),
	VERSION decimal(4,2) NOT NULL,
	ID decimal(10,2) DEFAULT NEXTVAL('"STUDY_SITES_ID_seq"'::TEXT) NOT NULL,
	IRB_APPROVAL_DATE timestamp NOT NULL,
	ROLE_CODE varchar(200) NOT NULL,
	STATUS_CODE varchar(200) NOT NULL,
	START_DATE timestamp NOT NULL,
	END_DATE timestamp,
	STUDY_ID decimal(10,2) NOT NULL,
	HCS_ID decimal(10,2) NOT NULL
) ;


ALTER TABLE ADDRESSES ADD CONSTRAINT PK_ADDRESSES 
	PRIMARY KEY (ID) ;

ALTER TABLE ARMS ADD CONSTRAINT PK_ARMS 
	PRIMARY KEY (ID) ;

ALTER TABLE EPOCHS ADD CONSTRAINT PK_EPOCHS 
	PRIMARY KEY (ID) ;

ALTER TABLE HC_SITE_INVESTIGATORS ADD CONSTRAINT PK_HC_SITE_INVESTIGATORS 
	PRIMARY KEY (ID) ;

ALTER TABLE HEALTHCARE_SITES ADD CONSTRAINT PK_HEALTHCARE_SITES 
	PRIMARY KEY (ID) ;

ALTER TABLE INVESTIGATORS ADD CONSTRAINT PK_INVESTIGATORS 
	PRIMARY KEY (ID) ;

ALTER TABLE PARTICIPANTS ADD CONSTRAINT PK_PARTICIPANTS 
	PRIMARY KEY (ID) ;

ALTER TABLE SCHEDULED_ARMS ADD CONSTRAINT PK_SCHEDULED_ARMS 
	PRIMARY KEY (ID) ;

ALTER TABLE STUDIES ADD CONSTRAINT PK_Study 
	PRIMARY KEY (ID) ;

ALTER TABLE STUDY_INVESTIGATORS ADD CONSTRAINT PK_STUDY_INVESTIGATORS 
	PRIMARY KEY (ID) ;

ALTER TABLE STUDY_PARTICIPANT_ASSIGNMENTS ADD CONSTRAINT PK_STUDY_PARTICIPANT_ASSIGNMEN 
	PRIMARY KEY (ID) ;

ALTER TABLE STUDY_SITES ADD CONSTRAINT PK_STUDY_SITES 
	PRIMARY KEY (ID) ;

ALTER TABLE ARMS ADD CONSTRAINT FK_ARM_EPH 
	FOREIGN KEY (EPH_ID) REFERENCES EPOCHS (ID) ;

ALTER TABLE EPOCHS ADD CONSTRAINT FK_EPH_STU 
	FOREIGN KEY (STU_ID) REFERENCES STUDIES (ID) ;

ALTER TABLE HC_SITE_INVESTIGATORS ADD CONSTRAINT FK_HSI_HCS 
	FOREIGN KEY (HCS_ID) REFERENCES HEALTHCARE_SITES (ID) ;

ALTER TABLE HC_SITE_INVESTIGATORS ADD CONSTRAINT FK_HSI_INV 
	FOREIGN KEY (INV_ID) REFERENCES INVESTIGATORS (ID) ;

ALTER TABLE HEALTHCARE_SITES ADD CONSTRAINT FK_HCS_ADD 
	FOREIGN KEY (ADDRESS_ID) REFERENCES ADDRESSES (ID) ;

ALTER TABLE PARTICIPANTS ADD CONSTRAINT FK_PRT_ADD 
	FOREIGN KEY (ADD_ID) REFERENCES ADDRESSES (ID) ;

ALTER TABLE SCHEDULED_ARMS ADD CONSTRAINT FK_SCA_ARM 
	FOREIGN KEY (ARM_ID) REFERENCES ARMS (ID) ;

ALTER TABLE SCHEDULED_ARMS ADD CONSTRAINT FK_SCA_SPA 
	FOREIGN KEY (SPA_ID) REFERENCES STUDY_PARTICIPANT_ASSIGNMENTS (ID) ;

ALTER TABLE STUDY_INVESTIGATORS ADD CONSTRAINT FK_STI_HSI 
	FOREIGN KEY (HSI_ID) REFERENCES HC_SITE_INVESTIGATORS (ID) ;

ALTER TABLE STUDY_INVESTIGATORS ADD CONSTRAINT FK_STI_STS 
	FOREIGN KEY (STS_ID) REFERENCES STUDY_SITES (ID) ;

ALTER TABLE STUDY_PARTICIPANT_ASSIGNMENTS ADD CONSTRAINT FK_SPA_PRT 
	FOREIGN KEY (PRT_ID) REFERENCES PARTICIPANTS (ID) ;

ALTER TABLE STUDY_PARTICIPANT_ASSIGNMENTS ADD CONSTRAINT FK_SPA_STS 
	FOREIGN KEY (STS_ID) REFERENCES STUDY_SITES (ID) ;

ALTER TABLE STUDY_SITES ADD CONSTRAINT FK_STS_HCS 
	FOREIGN KEY (HCS_ID) REFERENCES HEALTHCARE_SITES (ID) ;

ALTER TABLE STUDY_SITES ADD CONSTRAINT FK_STS_STU 
	FOREIGN KEY (STUDY_ID) REFERENCES STUDIES (ID) ;
	
ALTER TABLE IDENTIFIERS ADD CONSTRAINT PK_IDENTIFIERS 
	PRIMARY KEY (ID);

ALTER TABLE IDENTIFIERS ADD CONSTRAINT FK_IDENTIFIERS_PARTICIPANTS 
	FOREIGN KEY (PRT_ID) REFERENCES PARTICIPANTS (ID);

ALTER TABLE IDENTIFIERS ADD CONSTRAINT FK_IDENTIFIERS_SPA 
	FOREIGN KEY (SPA_ID) REFERENCES STUDY_PARTICIPANT_ASSIGNMENTS (ID);

ALTER TABLE IDENTIFIERS ADD CONSTRAINT FK_IDENTIFIERS_STUDIES 
	FOREIGN KEY (STU_ID) REFERENCES STUDIES (ID);

