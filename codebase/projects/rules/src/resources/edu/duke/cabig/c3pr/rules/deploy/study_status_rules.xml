<?xml version="1.0" encoding="UTF-8"?>
<package name="edu.duke.cabig.c3pr.rules.deploy.study_status_rules"
	xmlns="http://drools.org/drools-4.0" xmlns:drools="http://drools.org/drools-4.0" 
	xmlns:rules="http://drools.org/drools-4.0" 
	xmlns:xs="http://www.w3.org/2001/XMLSchema-instance" 
	xs:schemaLocation="http://drools.org/drools-4.0 drools-4.0.xsd">
	
	<global type="edu.duke.cabig.c3pr.rules.runtime.RuleContext" identifier="ruleContext"/>
	<global type="edu.duke.cabig.c3pr.rules.runtime.action.ActionDispatcher" identifier="actionDispatcher"/>
	
	<import name="edu.duke.cabig.c3pr.domain.*"/>
	<import name="edu.duke.cabig.c3pr.service.impl.*"/>
	
    <rule name="Study_Changed_Rule">
        <lhs>
        	<pattern identifier="plannedNotification" object-type="edu.duke.cabig.c3pr.domain.PlannedNotification"/>
        	<pattern identifier="scheduledNotificationService" object-type="edu.duke.cabig.c3pr.service.impl.ScheduledNotificationService"/>
        	<pattern identifier="study" object-type="edu.duke.cabig.c3pr.domain.Study"/>
        	<pattern identifier="schedulerService" object-type="edu.duke.cabig.c3pr.service.SchedulerService"/>
        	
        	<eval>"true" == "true"</eval>
        </lhs>
        <rhs>
        	int scheduledNotificationId = scheduledNotificationService.saveScheduledNotification(plannedNotification, study);
            schedulerService.scheduleNotification(plannedNotification, scheduledNotificationId);
        </rhs>        
    </rule>


</package>	