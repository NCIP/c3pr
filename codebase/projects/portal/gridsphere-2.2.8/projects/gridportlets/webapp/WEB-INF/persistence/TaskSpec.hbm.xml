<?xml version="1.0"?>

<!DOCTYPE hibernate-mapping PUBLIC
    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
    "http://hibernate.sourceforge.net/hibernate-mapping-2.0.dtd">

<hibernate-mapping>
    <class name="org.gridlab.gridsphere.services.task.impl.BaseTaskSpec" table="taskSpec"
           discriminator-value="TaskSpec">
        <!-- Object id -->
        <id
            name="oid"
            column="gsoid"
            type="java.lang.String"
            length="32"
            >
            <generator class="uuid.hex"/>

        </id>

        <discriminator column="subclass" type="string"/>

        <!-- User -->
        <property name="UserOid" type="string" column="useroid"/>

        <!-- Dn -->
        <property name="Dn" type="string" column="dn"/>

        <!-- Delete when task ends flag -->
        <property name="DeleteWhenTaskEndsFlag" type="boolean" column="delOnEnd"/>

        <!-- Task attributes -->
        <map name="TaskAttributeMap"
              table="TASK_SPEC_ATTRIBUTES"
              cascade="all-delete-orphan"
              lazy="true" batch-size="10">
            <key column="TASK_SPEC_OID"/>
            <index type="string" column="ATTRIBUTE_INDEX"/>
            <element column="TASK_ATTRIBUTE"
                     type="org.gridlab.gridsphere.services.task.impl.TaskAttributeUserType"/>
        </map>

        <!-- Task status listeners -->
        <list name="TaskStatusListenerClassNames"
              table="TASK_SPEC_LISTENERS"
              cascade="all-delete-orphan"
              lazy="true" batch-size="10">
            <key column="TASK_OID"/>
            <index type="string" column="LISTENER_INDEX"/>
            <element column="TASK_LISTENER" type="string"/>
        </list>

        <!-- Description -->
        <property name="Description" type="string" column="description"/>

        <!-- Base job spec -->
        <subclass name="org.gridlab.gridsphere.services.job.impl.BaseJobSpec"
                  discriminator-value="JobSpec">

            <!-- Directory -->
            <property name="Directory" type="string" column="JOB_DIR"/>

            <!-- Executable -->
            <property name="ExecutableLocation"
                      column="EXEC_LOC"
                      type="org.gridlab.gridsphere.services.file.impl.FileLocationUserType"/>

            <!-- Directory -->
            <property name="ExecutionMethodName" type="string" column="EXEC_TYPE"/>

            <!-- Stdout -->
            <property name="StdoutLocation"
                      column="SOUT_LOC"
                      type="org.gridlab.gridsphere.services.file.impl.FileLocationUserType"/>

            <!-- Stderr -->
            <property name="StderrLocation"
                      column="SERR_LOC"
                      type="org.gridlab.gridsphere.services.file.impl.FileLocationUserType"/>

            <!-- Arguments -->
            <list name="Arguments"
                  table="JOB_ARGS"
                  cascade="all-delete-orphan"
                  lazy="true"
                  batch-size="10">
                <key column="ARG_OID"/>
                <index column="ARG_NUM"/>
                <element column="ARGUMENT" type="string" not-null="true"/>
            </list>

            <!-- File stage parameters -->
            <list name="FileStageParameters"
                  table="FSTG_PARS"
                  cascade="all-delete-orphan"
                  lazy="true"
                  batch-size="10">
                <key column="FSTG_ID"/>
                <index column="FSTG_NUM"/>
                <element column="FSTG_URL"
                         type="org.gridlab.gridsphere.services.job.impl.FileStageParameterUserType"
                         not-null="true"/>
            </list>

            <!-- Checkpoint file locations -->
            <list name="CheckpointFileLocations"
                  table="CKPT_LOCS"
                  cascade="all-delete-orphan"
                  lazy="true"
                  batch-size="10">
                <key column="CKPT_ID"/>
                <index column="CKPT_NUM"/>
                <element column="CKPT_LOC"
                         type="org.gridlab.gridsphere.services.file.impl.FileLocationUserType"
                         not-null="true"/>
            </list>

            <!-- Environment variables -->
            <list name="EnvironmentVariables"
                  table="ENV_VARS"
                  cascade="all-delete-orphan"
                  lazy="true"
                  batch-size="10">
                <key column="VAR_ID"/>
                <index column="VAR_NUM"/>
                <element column="ENV_VAR"
                         type="org.gridlab.gridsphere.services.job.impl.EnvironmentVariableUserType"
                         not-null="true"/>
            </list>

            <!-- Rsl string -->
            <property name="RslString" type="text" column="rslString"/>

			<!-- GRAM job spec -->
            <subclass name="org.gridlab.gridsphere.services.resources.gram.GramJobSpec"
                      discriminator-value="GramJobSpec"/>

        </subclass>

        <!-- Base job migration spec-->
        <subclass name="org.gridlab.gridsphere.services.job.impl.BaseJobMigrationSpec"
                  discriminator-value="JobMigrationSpec">

            <!-- Job Id -->
            <property name="JobId" type="string" column="JOB_ID"/>

            <!-- Job spec -->
            <many-to-one
                name="JobSpec"
                class="org.gridlab.gridsphere.services.job.impl.BaseJobSpec"
                cascade="all"/>

        </subclass>

        <!-- Base file task spec -->
        <subclass name="org.gridlab.gridsphere.services.file.impl.BaseFileTaskSpec"
                  discriminator-value="FileTaskSpec">

            <subclass name="org.gridlab.gridsphere.services.file.tasks.impl.BaseFileBrowserTaskSpec"
                      discriminator-value="FileBrowserTaskSpec">

                <!-- Used by sub-classes -->
                <property name="FileResourceOid" type="string" column="fileResource"/>

                <!-- Base file listing spec -->
                <subclass name="org.gridlab.gridsphere.services.file.tasks.impl.BaseFileListingSpec"
                          discriminator-value="FileListingSpec">
                    <!-- Browser flag -->
                    <property name="BrowserFlag" type="boolean" column="browserFlag"/>

                    <!-- File set -->
                    <many-to-one
                        name="PersistedFileSet"
                        class="org.gridlab.gridsphere.services.file.impl.PersistedFileSet"
                        cascade="all"/>

                   <!-- Local host list spec -->
                   <subclass name="org.gridlab.gridsphere.services.resources.system.LocalHostListSpec"
                             discriminator-value="LocalHostListSpec"/>

                    <!-- Grid ftp list spec -->
                    <subclass name="org.gridlab.gridsphere.services.resources.gridftp.GridFtpListSpec"
                              discriminator-value="GridFtpListSpec"/>

                </subclass>


                <!-- Base file make dir spec -->
                <subclass name="org.gridlab.gridsphere.services.file.tasks.impl.BaseFileMakeDirSpec"
                          discriminator-value="FileMakeDirSpec">
                    <!-- Parent location -->
                    <property name="ParentLocation"
                              column="FILE_LOC"
                              type="org.gridlab.gridsphere.services.file.impl.FileLocationUserType"/>

                    <!-- Dir name -->
                    <property name="DirectoryName" type="string" column="DIR_NAME"/>

                    <!-- Local host make dir spec -->
                    <subclass name="org.gridlab.gridsphere.services.resources.system.LocalHostMakeDirSpec"
                              discriminator-value="LocalHostMakeDirSpec"/>

                    <!-- Grid ftp make dir spec -->
                    <subclass name="org.gridlab.gridsphere.services.resources.gridftp.GridFtpMakeDirSpec"
                              discriminator-value="org.gridlab.gridsphere.services.resources.gridftp.GridFtpMakeDirSpec"/>

                </subclass>

                <!-- Base file name change spec -->
                <subclass name="org.gridlab.gridsphere.services.file.tasks.impl.BaseFileNameChangeSpec"
                          discriminator-value="org.gridlab.gridsphere.services.file.tasks.FileNameChangeSpec">
                    <!-- File location -->
                    <property name="FileLocation"
                              column="FILE_LOC"
                              type="org.gridlab.gridsphere.services.file.impl.FileLocationUserType"/>

                    <!-- New file name -->
                    <property name="NewFileName" type="string" column="RENM_NAME"/>

                    <!-- Local host rename spec -->
                    <subclass name="org.gridlab.gridsphere.services.resources.system.LocalHostRenameSpec"
                              discriminator-value="org.gridlab.gridsphere.services.resources.system.LocalHostRenameSpec"/>

                    <!-- Grid ftp rename spec -->
                    <subclass name="org.gridlab.gridsphere.services.resources.gridftp.GridFtpRenameSpec"
                              discriminator-value="org.gridlab.gridsphere.services.resources.gridftp.GridFtpRenameSpec"/>

                </subclass>

                <!-- Base file transfer spec -->
                <subclass name="org.gridlab.gridsphere.services.file.tasks.impl.BaseFileTransferSpec"
                          discriminator-value="org.gridlab.gridsphere.services.file.tasks.FileTransferSpec">
                    <!-- Source -->
                    <many-to-one
                        name="PersistedFileSet"
                        class="org.gridlab.gridsphere.services.file.impl.PersistedFileSet"
                        cascade="all"/>

                    <!-- Destination -->
                    <property name="Destination"
                              column="FILE_LOC"
                              type="org.gridlab.gridsphere.services.file.impl.FileLocationUserType"/>

                    <!-- Used by sub-classes -->
                    <property name="DstResourceOid" type="string" column="dstResource"/>

                    <!-- Base file copy spec -->
                    <subclass name="org.gridlab.gridsphere.services.file.tasks.impl.BaseFileCopySpec"
                              discriminator-value="org.gridlab.gridsphere.services.file.tasks.FileCopySpec">

                        <!-- Local host copy spec -->
                        <subclass name="org.gridlab.gridsphere.services.resources.system.LocalHostCopySpec"
                                  discriminator-value="org.gridlab.gridsphere.services.resources.system.LocalHostCopySpec"/>

                        <!-- Grid ftp copy spec -->
                        <subclass name="org.gridlab.gridsphere.services.resources.gridftp.GridFtpCopySpec"
                                  discriminator-value="org.gridlab.gridsphere.services.resources.gridftp.GridFtpCopySpec"/>

                    </subclass>


                    <!-- Base file move spec -->
                    <subclass name="org.gridlab.gridsphere.services.file.tasks.impl.BaseFileMoveSpec"
                              discriminator-value="org.gridlab.gridsphere.services.file.tasks.FileMoveSpec">

                        <!-- Local host move spec -->
                        <subclass name="org.gridlab.gridsphere.services.resources.system.LocalHostMoveSpec"
                                  discriminator-value="org.gridlab.gridsphere.services.resources.system.LocalHostMoveSpec"/>

                        <!-- Grid ftp move spec -->
                        <subclass name="org.gridlab.gridsphere.services.resources.gridftp.GridFtpMoveSpec"
                                  discriminator-value="org.gridlab.gridsphere.services.resources.gridftp.GridFtpMoveSpec"/>

                    </subclass>


                </subclass>

                <!-- Base file deletion spec -->
                <subclass name="org.gridlab.gridsphere.services.file.tasks.impl.BaseFileDeletionSpec"
                          discriminator-value="org.gridlab.gridsphere.services.file.tasks.FileDeletionSpec">
                    <!-- Source -->
                    <many-to-one
                        name="PersistedFileSet"
                        class="org.gridlab.gridsphere.services.file.impl.PersistedFileSet"
                        cascade="all"/>

                    <!-- Local host delete spec -->
                    <subclass name="org.gridlab.gridsphere.services.resources.system.LocalHostDeleteSpec"
                              discriminator-value="org.gridlab.gridsphere.services.resources.system.LocalHostDeleteSpec"/>

                    <!-- Grid ftp delete spec -->
                    <subclass name="org.gridlab.gridsphere.services.resources.gridftp.GridFtpDeleteSpec"
                              discriminator-value="org.gridlab.gridsphere.services.resources.gridftp.GridFtpDeleteSpec"/>

                </subclass>

                <!-- Base file upload spec -->
                <subclass name="org.gridlab.gridsphere.services.file.tasks.impl.BaseFileUploadSpec"
                          discriminator-value="org.gridlab.gridsphere.services.file.tasks.FileUploadSpec">

                    <!-- Local file path -->
                    <property name="FilePath" type="string" column="FILE_PATH"/>

                    <!-- Upload location -->
                    <property name="UploadLocation"
                              column="FILE_LOC"
                              type="org.gridlab.gridsphere.services.file.impl.FileLocationUserType"/>

                    <!-- Grid ftp upload spec -->
                    <subclass name="org.gridlab.gridsphere.services.resources.gridftp.GridFtpUploadSpec"
                              discriminator-value="org.gridlab.gridsphere.services.resources.gridftp.GridFtpUploadSpec"/>

                    <!-- Local host upload spec -->
                      <subclass name="org.gridlab.gridsphere.services.resources.system.LocalHostUploadSpec"
                                discriminator-value="org.gridlab.gridsphere.services.resources.system.LocalHostUploadSpec"/>

                </subclass>

                <!-- Base file download spec -->
                <subclass name="org.gridlab.gridsphere.services.file.tasks.impl.BaseFileDownloadSpec"
                          discriminator-value="org.gridlab.gridsphere.services.file.tasks.FileDownloadSpec">

                    <!-- File location -->
                    <property name="FileLocation"
                              column="FILE_LOC"
                              type="org.gridlab.gridsphere.services.file.impl.FileLocationUserType"/>

                    <!-- Local file path -->
                    <property name="DownloadPath" type="string" column="FILE_PATH"/>

                    <!-- Grid ftp download spec -->
                    <subclass name="org.gridlab.gridsphere.services.resources.gridftp.GridFtpDownloadSpec"
                              discriminator-value="org.gridlab.gridsphere.services.resources.gridftp.GridFtpDownloadSpec"/>

                    <!-- Local host download spec -->
                      <subclass name="org.gridlab.gridsphere.services.resources.system.LocalHostDownloadSpec"
                                discriminator-value="org.gridlab.gridsphere.services.resources.system.LocalHostDownloadSpec"/>

                </subclass>

            </subclass>

            <!-- Credential mapping spec -->
            <subclass name="org.gridlab.gridsphere.services.security.gss.impl.CredentialMappingSpecImpl"
                      discriminator-value="CredentialMappingSpec">

                <!-- Credential dn -->
                <property name="CredentialDn" type="string" column="CRED_DN"/>

                <!-- Test flag -->
                <property name="TestAllResources" type="boolean" column="TEST_ALL"/>

                <!-- Resource dns -->
                <list name="ResourceDns"
                      table="RSRC_DNS"
                      cascade="all-delete-orphan"
                      lazy="true"
                      batch-size="10">
                    <key column="RSRC_ID"/>
                    <index column="RSRC_NUM"/>
                    <element column="RSRC_DN" type="string" not-null="true"/>
                </list>

            </subclass>

        </subclass>

    </class>

</hibernate-mapping>
