<project name="docs" default="docs" basedir=".">

    <!-- Configurable properties -->
    <property file="config/build/docs.properties"/>

    <!-- =================================================================== -->
    <!-- Installs Grid Portlets documentation                                -->
    <!-- =================================================================== -->
    <target name="docs" description="Installs Grid Portlets documentation">
        <antcall target="docs-clean"/>
        <antcall target="docs-build"/>
        <antcall target="docs-undeploy"/>
        <antcall target="docs-deploy"/>
    </target>

    <!-- =================================================================== -->
    <!-- Cleans Grid Portlets documentation                                  -->
    <!-- =================================================================== -->
    <target name="docs-clean" description="Cleans Grid Portlets documentation">
        <delete quiet="true" dir="${build.docs}"/>
    </target>

    <!-- =================================================================== -->
    <!-- Builds Grid Portlets documentation                                  -->
    <!-- =================================================================== -->
    <target name="docs-build" description="Builds Grid Portlets documentation">
        <mkdir dir="${build.docs}"/>
        <antcall target="docs-javadocs"/>
    </target>

    <!-- =================================================================== -->
    <!-- Deploys Grid Portlets documentation to GridSphere web application   -->
    <!-- =================================================================== -->
    <target name="docs-deploy" description="Deploys Grid Portlets documentation">

        <echo message="Deploying Grid Portlets documentation"/>

        <!-- Delete existing documentation -->
        <delete failonerror="false" dir="${project.webapp}/docs"/>

        <!-- Javadocs -->
        <antcall target="docs-javadocs-deploy"/>

        <!-- Deploy new documentation -->
        <copy todir="${project.webapp}/docs">
            <fileset dir="${docs}">
                <exclude name="main.html"/>
                <exclude name="DefaultHelpComp.jsp"/>
            </fileset>
        </copy>

        <!-- Deploy our own main.html -->
        <copy failonerror="false"
              overwrite="true"
              file="${docs}/main.html"
              todir="${gridsphere.webapp}/html"/>

        <!-- Deploy the help comp -->
        <copy failonerror="false"
              overwrite="true"
              file="${docs}/DefaultHelpComp.jsp"
              todir="${project.webapp}/jsp/action/"/>

    </target>

    <!-- =================================================================== -->
    <!-- Installs Grid Portlets documentation                                -->
    <!-- =================================================================== -->
    <target name="docs-uninstall" description="Uninstalls Grid Portlets documentation">
        <antcall target="docs-clean"/>
        <antcall target="docs-undeploy"/>
    </target>

    <!-- =================================================================== -->
    <!-- Undeploys Grid Portlets documentation                               -->
    <!-- =================================================================== -->
    <target name="docs-undeploy" description="Undeploys Grid Portlets documentation">

        <!-- Javadocs -->
        <antcall target="docs-javadocs-undeploy"/>

        <!-- Replace gridsphere main.html -->
        <copy overwrite="true"
              file="${gridsphere.home}/webapps/gridsphere/html/main.html"
              todir="${gridsphere.webapp}/html"/>

        <!-- Replace gridportlets DefaultHelpComp.jsp -->
        <copy overwrite="true"
              file="webapp/jsp/action/DefaultHelpComp.jsp"
              todir="${project.webapp}/jsp/action"/>

        <!-- Delete docs from gridportlets web application -->
        <delete failonerror="false" dir="${project.webapp}/docs"/>

    </target>

    <!-- =================================================================== -->
    <!-- Builds javadocs                                                     -->
    <!-- =================================================================== -->
    <target name="docs-javadocs" description="Builds Grid Portlets javadocs">
        <antcall target="docs-javadocs-clean"/>
        <antcall target="docs-javadocs-create"/>
        <antcall target="docs-javadocs-deploy"/>
    </target>

    <!-- =================================================================== -->
    <!-- Cleans javadocs                                                     -->
    <!-- =================================================================== -->
    <target name="docs-javadocs-clean" description="Cleans Grid Portlets javadocs">
        <delete quiet="true" dir="${build.javadoc}"/>
    </target>

    <!-- =================================================================== -->
    <!-- Creates javadocs                                                    -->
    <!-- =================================================================== -->
    <target name="docs-javadocs-create" description="Create Grid Portlets javadocs">
        <echo>Creating gridportlets Javadocs</echo>
        <mkdir dir="${build.javadoc}"/>
        <javadoc packagenames="org.gridlab.gridsphere.portlets.*,
                               org.gridlab.gridsphere.services.*"
                 excludepackagenames="org.gridlab.gridsphere.services.resources.*"
            sourcepath="src"
            classpathref="classpath"
            destdir="${build.javadoc}"
            author="true"
            version="true"
            splitindex="true"
            use="true"
            breakiterator="true"
            maxmemory="256m"
            windowtitle="${project.title}"
            doctitle="${project.api}"
            bottom="Copyright &#169; 2002,2003,2004 GridLab Project. All Rights Reserved.">

            <group title="Grid Portlets "
                packages="org.gridlab.gridsphere.portlets.*"/>

            <group title="Grid Portlet Services "
                packages="org.gridlab.gridsphere.services.*"/>

        </javadoc>
    </target>

    <!-- =================================================================== -->
    <!-- Deploys javadocs                                                    -->
    <!-- =================================================================== -->
    <target name="docs-javadocs-deploy" description="Deploys Grid Portlets javadocs">
        <mkdir dir="${docs}"/>
        <mkdir dir="${docs.javadoc}"/>
        <copy todir="${docs.javadoc}">
            <fileset dir="${build.javadoc}"/>
        </copy>
    </target>

    <!-- =================================================================== -->
    <!-- Undeploys javadocs                                                  -->
    <!-- =================================================================== -->
    <target name="docs-javadocs-undeploy" description="Undeploys Grid Portlets javadocs">
        <delete failonerror="false" dir="${docs.javadoc}"/>
    </target>

</project>
