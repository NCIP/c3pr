<project name="dist" default="dist" basedir=".">

    <!-- Configurable properties -->
    <property file="config/build/dist.properties"/>

    <!-- =================================================================== -->
    <!-- Creates all distributions                                           -->
    <!-- =================================================================== -->

    <target name="dist" description="Creates all distributions">
        <antcall target="dist-clean"/>
        <antcall target="dist-src"/>
    </target>

    <!-- =================================================================== -->
    <!-- Cleans all distributions                                            -->
    <!-- =================================================================== -->

    <target name="dist-clean" description="Cleans all distributions">
        <!-- Delete what currently exists -->
        <delete failonerror="false" includeEmptyDirs="true">
            <fileset dir="${dist}"/>
        </delete>
    </target>

    <!-- =================================================================== -->
    <!-- Creates source distributions                                        -->
    <!-- =================================================================== -->

    <target name="dist-src" description="Creates the source distributions">
        <antcall target="dist-src-clean"/>
        <antcall target="dist-src-create"/>
        <antcall target="dist-src-tgz"/>
        <antcall target="dist-src-zip"/>
    </target>

    <!-- =================================================================== -->
    <!-- Cleans source distributions                                         -->
    <!-- =================================================================== -->

    <target name="dist-src-clean" description="Cleans the document distributions">
        <!-- Delete what currently exists -->
        <delete failonerror="false" includeEmptyDirs="true">
            <fileset dir="${dist.gridportlets.src}"/>
            <fileset dir="${dist}" includes="${gridportlets.src.dir}.*"/>
        </delete>
    </target>

    <!-- =================================================================== -->
    <!-- Creates the source distribution directory                           -->
    <!-- =================================================================== -->

    <target name="dist-src-create" description="Creates a new source distribution directory">
        <!-- Create required directories -->
        <mkdir dir="${dist}"/>
        <!-- Top-level files -->
        <copy todir="${dist.gridportlets.src}" includeEmptyDirs="false">
            <fileset dir=".">
                <include name="build.*"/>
                <include name="*.txt"/>
            </fileset>
        </copy>
        <!-- Configure directory -->
        <copy todir="${dist.gridportlets.src}/config" includeEmptyDirs="false">
            <fileset dir="config"/>
        </copy>
        <!-- Docs directory -->
        <copy todir="${dist.gridportlets.src}/docs" includeEmptyDirs="false">
            <fileset dir="docs"/>
        </copy>
        <!-- Libraries directory -->
        <copy todir="${dist.gridportlets.src}/lib" includeEmptyDirs="false">
            <fileset dir="lib"/>
        </copy>
        <!-- Source directory -->
        <copy todir="${dist.gridportlets.src}/src" includeEmptyDirs="false">
            <fileset dir="src"/>
        </copy>
        <!-- Tests directory -->
        <copy todir="${dist.gridportlets.src}/tests" includeEmptyDirs="false">
            <fileset dir="tests"/>
        </copy>
        <!-- Web application directory -->
        <copy todir="${dist.gridportlets.src}/webapp" includeEmptyDirs="false">
            <fileset dir="webapp"/>
        </copy>
    </target>

    <!-- =================================================================== -->
    <!-- Creates the tarball source distribution                             -->
    <!-- =================================================================== -->

    <target name="dist-src-tgz" description="Creates a new tarball source distribution">
        <!-- Create new tar file -->
        <tar basedir="${dist}" destfile="${dist}/${gridportlets.src.tar}" includes="${gridportlets.src.dir}/**"/>
        <!-- Gzip tar file -->
        <gzip zipfile="${dist}/${gridportlets.src.tgz}" src="${dist}/${gridportlets.src.tar}"/>
        <!-- Delete tar file (but leave gzip file -->
        <delete failonerror="false">
            <fileset dir="${dist}" includes="${gridportlets.src.tar}"/>
        </delete>
    </target>

    <!-- =================================================================== -->
    <!-- Creates the zipped source distribution                              -->
    <!-- =================================================================== -->

    <target name="dist-src-zip" description="Creates a new zipped source distribution">
        <!-- Delete old zip file -->
        <delete failonerror="false">
            <fileset dir="${dist}" includes="${gridportlets.src.zip}"/>
        </delete>
        <!-- Create new zip file -->
        <zip basedir="${dist}" destfile="${dist}/${gridportlets.src.zip}" includes="${gridportlets.src.dir}/**"/>
    </target>

</project>
