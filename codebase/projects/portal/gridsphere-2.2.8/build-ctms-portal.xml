
<project name="ctms-portal" default="deploy" basedir=".">

    <!-- Configurable properties -->
    <property file="build.properties"/>

    <property name="ext.lib.dir" value="${basedir}/ext/lib"/>

    <property name="projects.dir" value="${basedir}/projects"/>

    <property name="projects.list" value="gridauth,ctmsportlets,extras,gridportlets,jsrportlets"/>

    <target name="prepare">
        <taskdef resource="net/sf/antcontrib/antlib.xml">
            <classpath>
                <pathelement location="${ext.lib.dir}/ant-contrib.jar"/>
            </classpath>
        </taskdef>
    </target>

    <target name="clean" description="Will clean the portal project" depends="prepare">
        <ant antfile="build.xml" target="clean"/>

        <for list="${projects.list}" parallel="false" param="project.name" trim="true">
            <sequential>
                <echo message="Building project @{project.name}."/>
                <ant dir="${projects.dir}/@{project.name}" antfile="build.xml"
                     target="clean" inheritall="false"/>
                <echo message="Built project @{project.name}."/>
            </sequential>
        </for>
    </target>

    <target name="deploy" depends="prepare">
        <ant antfile="build.xml" target="deploy"/>

        <for list="${projects.list}" parallel="false" param="project.name" trim="true">
            <sequential>
                <echo message="Building project @{project.name}."/>
                <ant dir="${projects.dir}/@{project.name}" antfile="build.xml"
                     target="deploy" inheritall="false"/>
                <echo message="Built project @{project.name}."/>
            </sequential>
        </for>
    </target>

    <target name="install" depends="prepare" description="Will Install the project.">
            <ant antfile="build.xml" target="install"/>

            <for list="${projects.list}" parallel="false" param="project.name" trim="true">
                <sequential>
                    <echo message="Building project @{project.name}."/>
                    <ant dir="${projects.dir}/@{project.name}" antfile="build.xml"
                         target="install" inheritall="false"/>
                    <echo message="Built project @{project.name}."/>
                </sequential>
            </for>
        </target>

    <target name="createDatabase" description="Will create database. Must be run the first time you deploy">
       <ant antfile="build.xml" target="create-database"/>
    </target>

</project>