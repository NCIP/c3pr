<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:p="http://www.springframework.org/schema/p"
	xsi:schemaLocation="
    http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
    http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd">

	<bean class="org.springframework.beans.factory.annotation.RequiredAnnotationBeanPostProcessor" />

	<bean id="messageSource"
		class="org.springframework.context.support.ResourceBundleMessageSource">
		<property name="basename" value="messages"/>
	</bean>

	<bean id="noCacheTemplate" abstract="true">
		<property name="cacheSeconds" value="0"/>
	</bean>

	<bean id="urlMappingName"
		class="org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping">
		<property name="interceptors">
			<list>
				<ref bean="loginCheckInterceptor"/>
				<ref bean="sectionInterceptor" />
			</list>
		</property>
	</bean>

	<bean id="viewResolver"
		class="org.springframework.web.servlet.view.InternalResourceViewResolver">
		<property name="viewClass" value="org.springframework.web.servlet.view.JstlView"/>
		<property name="prefix" value="/WEB-INF/views/"/>
		<property name="suffix" value=".jsp"/>
	</bean>

	<bean id="urlResolver"
		class="edu.duke.cabig.c3pr.utils.web.spring.BeanNameControllerUrlResolver">
		<property name="servletName" value="pages"/>
	</bean>

	<bean name="/study/createStudy" id="createStudyController" class="edu.duke.cabig.c3pr.web.CreateStudyController" autowire="byName"/>
	<bean name="/study/confirm" id="confirmStudyController" autowire="byType" class="edu.duke.cabig.c3pr.web.ConfirmStudyController" />
    <bean name="/study/editStudy" id="editStudyController" class="edu.duke.cabig.c3pr.web.EditStudyController" autowire="byName"/>
	    
	<bean name="/study/searchStudy" id="searchStudyController"
		lazy-init="true" class="edu.duke.cabig.c3pr.web.SearchStudyController"
		autowire="byName">
		<property name="commandClass" value="edu.duke.cabig.c3pr.web.SearchCommand"/>
		<property name="formView" value="study/study_search" />
		<property name="successView" value="study/study_searchresults" />
	</bean>
	<bean name="/participant/createParticipant"
		id="createParticipantController" lazy-init="true"
		class="edu.duke.cabig.c3pr.web.CreateParticipantController"
		autowire="byName">
		<property name="commandClass" value="edu.duke.cabig.c3pr.domain.Participant" />
		<!-- Set the pages in Controller -->
	</bean>
	<bean name="/participant/searchParticipant"
		id="searchParticipantController" lazy-init="true"
		class="edu.duke.cabig.c3pr.web.SearchParticipantController"
		autowire="byName">
		<property name="formView" value="participant/participant_search" />
		<property name="successView" value="participant/participant_search_results" />
		<property name="commandClass"
			value="edu.duke.cabig.c3pr.web.SearchCommand" />
	</bean>
	<bean name="/participant/editParticipant"
		id="editParticipantController" lazy-init="true"
		class="edu.duke.cabig.c3pr.web.EditParticipantController"
		autowire="byName">
		<property name="commandClass" value="edu.duke.cabig.c3pr.domain.Participant" />
		<property name="commandName" value="command" />
	</bean>
	<bean name="/registration/searchAndRegister"
		id="searchAndRegisterController" lazy-init="true"
		class="edu.duke.cabig.c3pr.web.SearchAndRegisterController"
		autowire="byName">
		<property name="commandClass" value="edu.duke.cabig.c3pr.web.SearchRegisterCommand"/>
		<property name="formView" value="home" />
		<property name="successView" value="registration/reg_protocol_search" />
	</bean>
	<bean name="/registration/searchSubjectInRegister"
		id="searchSubjectInRegisterController" lazy-init="true"
		class="edu.duke.cabig.c3pr.web.SearchSubjectInRegisterController"
		autowire="byName">
		<property name="formView" value="registration/reg_enroll_patient" />
		<property name="successView" value="registration/reg_patient_search" />
		<property name="commandClass" value="edu.duke.cabig.c3pr.web.SearchCommand" />
	</bean>
	<bean name="/registration/searchStudyInRegister"
		id="searchStudyInRegisterController" lazy-init="true"
		class="edu.duke.cabig.c3pr.web.SearchStudyInRegisterController"
		autowire="byName">
		<property name="formView" value="registration/reg_enroll_study" />
		<property name="successView" value="registration/reg_study_search" />
		<property name="commandClass" value="edu.duke.cabig.c3pr.web.SearchCommand"/>
	</bean>
	<bean name="/registration/register" id="registerController"
		lazy-init="true" class="edu.duke.cabig.c3pr.web.RegisterController"
		autowire="byName">
		<property name="isBroadcastEnable" value="${broadcastEnable}" />
		<property name="commandClass"
			value="edu.duke.cabig.c3pr.domain.StudyParticipantAssignment" />
		<property name="commandName" value="command" />
		<property name="pages">
			<list>
				<value>registration/reg_registration_details</value>
				<value>registration/reg_check_eligibility</value>
				<value>registration/reg_stratify</value>
				<value>registration/reg_randomize</value>
				<value>registration/reg_submit</value>
				<value>registration/reg_confirm_reg</value>
				<value>registration/reg_identifiers</value>
			</list>
		</property>
	</bean>
	<bean name="/registration/registrationDetails" id="registrationDetailsController"
		lazy-init="true" class="edu.duke.cabig.c3pr.web.RegistrationDetailsController"
		autowire="byName">
		<property name="commandClass"
			value="edu.duke.cabig.c3pr.domain.StudyParticipantAssignment" />
		<property name="commandName" value="command" />
	</bean>

	<bean id="sectionInterceptor"
		class="edu.duke.cabig.c3pr.utils.web.navigation.SectionInterceptor">
		<property name="sections">
			<list>
				<bean
					class="edu.duke.cabig.c3pr.utils.web.navigation.Section"
					autowire="byType" p:displayName="Registration"
					p:mainController="searchAndRegisterController">
					<property name="pathMapping" value="/registration/**"/>
				</bean>
				<bean
					class="edu.duke.cabig.c3pr.utils.web.navigation.Section"
					autowire="byType" p:displayName="Studies"
					p:mainController="searchStudyController">
					<property name="pathMapping" value="/study/**"/>
					<property name="tasks">
						<list>
							<bean
								class="edu.duke.cabig.c3pr.utils.web.navigation.Task"
								autowire="byType" p:displayName="Search Study"
								p:linkName="searchStudyController" />
							<bean
								class="edu.duke.cabig.c3pr.utils.web.navigation.Task"
								autowire="byType" p:displayName="Create Study"
								p:linkName="createStudyController" />
						</list>
					</property>
				</bean>
				<bean
					class="edu.duke.cabig.c3pr.utils.web.navigation.Section"
					autowire="byType" p:displayName="Subjects"
					p:mainController="searchParticipantController">
					<property name="pathMapping" value="/participant/**"/>
					<property name="tasks">
						<list>
							<bean
								class="edu.duke.cabig.c3pr.utils.web.navigation.Task"
								autowire="byType" p:displayName="Search Subject"
								p:linkName="searchParticipantController" />
							<bean
								class="edu.duke.cabig.c3pr.utils.web.navigation.Task"
								autowire="byType" p:displayName="Create Subject"
								p:linkName="createParticipantController" />
						</list>
					</property>
				</bean>
			</list>
		</property>
	</bean>

	<bean id="loginCheckInterceptor"
		class="edu.duke.cabig.c3pr.web.accesscontrol.LoginCheckInterceptor">
		<property name="enableLogin" value="${enableLogin}"/>
	</bean>	
</beans>