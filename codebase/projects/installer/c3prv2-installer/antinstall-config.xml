<?xml version="1.0"?>
<!DOCTYPE installer PUBLIC "-//tp23 //DTD Ant Installer Config//EN" "http://antinstaller.sf.net/dtd/antinstall-config-0.7.dtd">
<!--

This is the install config for c3prv2 installer
-->

<installer
        ui="swing,text"
        verbose="false"
        lookAndFeel="jgoodies"
        name="C3PRV2 Installer"
        windowIcon="/resources/c3prv2_installer_icon-32.gif"
        defaultImageResource="/resources/installer_banner.gif"
        antialiased="true"
        minJavaVersion="1.5">

    <!--Introduction Screen-->
    <page
            type="input"
            name="intro"
            displayText="Welcome to the C3PRV2 installer program">
        <comment
                displayText="This will help you Install/Uninstall C3PRV2 Application"
                />

    </page>


    <!--License-->
    <page
            type="license"
            name="License"
            displayText="License Agreement"
            resource="/resources/c3prv2_license.txt"/>

    <page
            type="input"
            name="DeployDir"
            displayText="Installation directory">
        <directory
                property="install.dir"
                defaultValue="/tmp/c3prv2"
                defaultValueWin="${env.ProgramFiles}\c3prv2"
                displayText="Select an installation directory"
                create="true"/>
    </page>

    <page
            type="input"
            displayText="Install Tomcat"
            name="installTomcat">
        <target-select displayText="Select" property="install.new.tomcat"
                       defaultValue="installNewTomcat">
            <option text="Install new Tomcat" value="installNewTomcat"/>
            <option text="Choose Existing" value="installExistingTomcat"/>
        </target-select>
    </page>

    <page
            type="input"
            name="selectTomcatInstallDir"
            displayText="Select Directory to install Tomcat"
            ifTarget="installNewTomcat">
        <directory
                property="tomcat.home"
                displayText="Tomcat Directory"
                defaultValue="${install.dir}/apache-tomcat-5.5.23"
                checkExists="true"
                create="true"
                />
    </page>

    <!--Select Tomcat-->
    <page
            type="input"
            name="selectExistingTomcat"
            displayText="Select Tomcat Directory"
            ifTarget="installExistingTomcat">
        <directory
                property="tomcat.home"
                displayText="Tomcat Directory"
                defaultValue="${env.CATALINA_HOME}"
                checkExists="true"/>
    </page>

    <page type="text"
          name="existingTomcatInstructions"
          ifTarget="installExistingTomcat"
          htmlResource="/resources/Existing_Tomcat_Instructions.html"
          displayText="Configure tomcat">
        <comment bold="true" displayText="Replace"/>
    </page>

    <page
            type="input"
            name="selectLogFilename"
            displayText="Select Log File name"
            ifTarget="deploy-webapp">
        <text
                property="log4j.filename"
                displayText="Log Filename"
                defaultValue="c3pr.log"/>

        <comment/>

        <comment
                displayText="Note: Logs will be created in ${tomcat.home}/logs"
                bold="true"/>
    </page>

    <!--Select what to install-->
    <page
            type="input"
            name="selectComponents"
            displayText="Components to install">
        <comment
                displayText="Choose the components you want to install"
                bold="true"/>
        <target
                displayText="C3PRV2 Web Application"
                target="deploy-webapp"
                defaultValue="true"
                force="true"
                />
        <target
                displayText="C3PRV2 Source Code"
                target="deploy-codebase"
                defaultValue="true"
                />
        <comment displayText="Note:Source code will be installed in ${install.dir}/codebase"/>

    </page>


    <!--CSM configure-->
    <page
            type="input"
            name="configureCSM"
            displayText="Configure CSM"
            ifTarget="deploy-webapp">

        <target
                displayText="Configure CSM"
                target="tomcat.security"
                defaultValue="true"
                />
        <comment/>
        <comment
                displayText="Note: Unselect only if you know what you are doing."
                bold="true"/>
        <!--set this property anyway-->
        <hidden property="csm.context.name" value="c3pr"/>
    </page>

    <page
            type="input"
            name="selectAuthorizationSwitch"
            displayText="Enable/Disable Authorization"
            ifTarget="tomcat.security">
        <select property="authorizationSwitch" displayText="Select Option" defaultValue="true">
            <option text="Enable Authorization" value="true"/>
            <option text="Disable Authorization" value="false"/>
        </select>
    </page>


    <!--Database properties-->
    <page
            type="input"
            name="selectDatabase"
            displayText="Select Database"
            ifTarget="deploy-webapp">
        <select
                property="database.type"
                displayText="Select your Database type"
                defaultValue="oracle">
            <option text="Oracle" value="oracle"/>
            <option text="PostgreSQL" value="postgres"/>
            <option text="Other/none" value="none"/>
        </select>
    </page>

    <page type="input"
          name="createDatabaseChoice"
          displayText="Create Database"
          ifProperty="${database.type}!=none">
        <target
                displayText="Create/Update Database"
                target="database.migrate"
                defaultValue="true"
                />
    </page>

    <page
            type="input"
            name="oracleProperties"
            displayText="Oracle Properties"
            ifProperty="${database.type}==oracle">
        <text
                property="datasource.url"
                displayText="Database URL"
                defaultValue="jdbc:oracle:thin:@localhost:1522:c3pr_dev"
                />
        <text
                property="datasource.username"
                displayText="Database Username"
                defaultValue="c3pr_dev"
                regex="*"/>
        <text
                property="datasource.password"
                displayText="Database Password"
                defaultValue="c3pr_dev"
                />
        <text
                property="datasource.schema"
                displayText="Database Schema"
                defaultValue="c3pr_dev"
                />
        <hidden
                property="datasource.driver"
                value="oracle.jdbc.OracleDriver"
                />
        <hidden
                property="datasource.dialect"
                value="org.hibernate.dialect.Oracle9Dialect"
                />
    </page>


    <page
            name="postgresProperties"
            type="input"
            displayText="PostgreSQL Properties"
            ifProperty="${database.type}==postgres">
        <text
                property="datasource.url"
                displayText="Database URL"
                defaultValue="jdbc:postgresql://localhost:5432/c3pr_dev"
                />

        <text
                property="datasource.username"
                displayText="Database Username"
                defaultValue="pg"
                />
        <text
                property="datasource.password"
                displayText="Database Password"
                defaultValue="pguser"
                />

        <hidden
                property="datasource.driver"
                value="org.postgresql.Driver"/>

        <hidden
                property="datasource.dialect"
                value="org.hibernate.dialect.PostgreSQLDialect"/>
    </page>

    <page
            type="input"
            name="hotlinks"
            displayText="CTMSi Hot Links">
        <text property="hotlinks.psc"
              displayText="PSC Hotlink"
              defaultValue="http://localhost:8041/studycalendar/pages/schedule"/>
        <text property="hotlinks.caaers"
              displayText="CAAERS Hotlink"
              defaultValue="http://localhost:8030/caaers/pages/ae/list"/>
        <text property="hotlinks.c3d"
              displayText="C3D Hotlink"
              defaultValue="https://octrials-train.nci.nih.gov/opa45/rdclaunch.htm"/>
    </page>

    <page
            type="input"
            name="ESB"
            displayText="ESB configuration">
        <select defaultValue="false"
                displayText="Enable ESB"
                property="broadcastEnable">
            <option text="true" value="true"/>
            <option text="false" value="false"/>
        </select>
    </page>

    <page
            type="input"
            ifProperty="broadcastEnable==true">
        <text property="esb.brokerUrl"
              defaultValue="tcp://localhost:61616"
              displayText="ESB url"/>
    </page>

    <page
            type="input"
            name="Grid"
            displayText="Grid Infrastructure">
        <text property="grid.idpUrl"
              displayText="IDP url"
              defaultValue="https://localhost:8446/wsrf/services/cagrid/AuthenticationService"
                />
        <text property="grid.ifsUrl"
              displayText="IFS url"
              defaultValue="https://localhost:8443/wsrf/services/cagrid/Dorian"
                />
        <!--no need for this-->
        <hidden property="enableLogin" value="false"/>
    </page>

    <page
            type="progress"
            name="progress"
            showTargets="true"
            displayText="C3PRV2 Installation progress"
            target="cleanUp">
    </page>

</installer>